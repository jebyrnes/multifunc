<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assessing Multifunctionality with the multifunc package • multifunc</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Assessing Multifunctionality with the multifunc package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multifunc</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/multifunc_biodepth.html">Assessing Multifunctionality with the multifunc package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jebyrnes/multifunc">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Assessing Multifunctionality with the multifunc package</h1>
                        <h4 class="author">Jarrett Byrnes</h4>
            
            <h4 class="date">2018-07-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jebyrnes/multifunc/blob/master/../vignettes/multifunc_biodepth.Rmd"><code>../vignettes/multifunc_biodepth.Rmd</code></a></small>
      <div class="hidden name"><code>multifunc_biodepth.Rmd</code></div>

    </div>

    
    
<div id="using-the-multifunc-package-for-analysis-of-biodiversity-ecosystem-multifunctionality-relationships-in-the-biodepth-experiment" class="section level1">
<h1 class="hasAnchor">
<a href="#using-the-multifunc-package-for-analysis-of-biodiversity-ecosystem-multifunctionality-relationships-in-the-biodepth-experiment" class="anchor"></a>Using the <em>multifunc</em> package for analysis of Biodiversity Ecosystem Multifunctionality Relationships in the BIODEPTH Experiment</h1>
<p><br>
## Intro</p>
<p>This is a step-by-step walk-through of the analysis of the German BIODEPTH site in the paper to illustrate the different analyses we conducted to evaluate the relationship between biodiversity and ecosystem multifunctionality.</p>
<p>We begin by loading the <em>multifunc</em> package. If it is not currently installed, it can be found on github, and installed using the <em>devtools</em> library.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(devtools)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"multifunc"</span>, <span class="dt">username=</span><span class="st">"jebyrnes"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(multifunc)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#for plotting</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#for data</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw">library</span>(reshape2)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="kw">library</span>(plyr)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#for analysus</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="kw">library</span>(car)</a></code></pre></div>
<p>Next, we load in the BIODEPTH data. We use some of the helper functions in the package to identify the column numbers of the relevant functions for later use.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#Read in data  to run sample analyses on the biodepth data</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">data</span>(all_biodepth)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">allVars&lt;-<span class="kw"><a href="../reference/qw.html">qw</a></span>(biomassY3, root3, N.g.m2,  light3, N.Soil, wood3, cotton3)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">varIdx&lt;-<span class="kw">which</span>(<span class="kw">names</span>(all_biodepth) <span class="op">%in%</span><span class="st"> </span>allVars)</a></code></pre></div>
<p>As we want to work with just the German data, we next subset down the data to just Germany. We then look at the whether species were seeded or not, and determine which species were indeed seeded in Germany. If a column of species is full of zeroes, then it was not seeded in these plots. We will need the column indices of relevant species for later use in the overlap analyses.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">#######</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#Now, specify what data we're working with - Germany</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#and the relevant variables we'll be working with</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">#######</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">germany&lt;-<span class="kw">subset</span>(all_biodepth, all_biodepth<span class="op">$</span>location<span class="op">==</span><span class="st">"Germany"</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">vars&lt;-<span class="kw"><a href="../reference/whichVars.html">whichVars</a></span>(germany, allVars)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">species&lt;-<span class="kw"><a href="../reference/relevantSp.html">relevantSp</a></span>(germany,<span class="dv">26</span><span class="op">:</span><span class="kw">ncol</span>(germany))</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">spIDX &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">names</span>(germany) <span class="op">%in%</span><span class="st"> </span>species) <span class="co">#in case we need these</span></a></code></pre></div>
<div id="single-function-approach" class="section level2">
<h2 class="hasAnchor">
<a href="#single-function-approach" class="anchor"></a>Single Function Approach</h2>
<p>First, we will demonstrate the qualitative single function approach. As we’re using <em>ggplot2</em> for plotting, we’ll use <em>reshape</em> to melt the data into something suitable to make a nice faceted plot of each relationship.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">germanyForPlotting&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/reshape2/topics/melt">melt</a></span>(germany[,<span class="kw">c</span>(<span class="dv">8</span>,<span class="kw">which</span>(<span class="kw">names</span>(germany) <span class="op">%in%</span><span class="st"> </span>vars))], <span class="dt">id.vars=</span><span class="st">"Diversity"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">germanyForPlotting<span class="op">$</span>variable &lt;-<span class="st"> </span><span class="kw">factor</span>(germanyForPlotting<span class="op">$</span>variable)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#make the levels of the functions into something nice for plots</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">levels</span>(germanyForPlotting<span class="op">$</span>variable) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'Aboveground Biomass'</span>, <span class="st">'Root Biomass'</span>, <span class="st">'Cotton Decomposition'</span>, <span class="st">'Soil Nitrogen'</span>, <span class="st">'Plant Nitrogen'</span>)</a></code></pre></div>
<p>Nest, as we want to display additional information about the fit of diversity to each function, we’ll need to iterate over each function, derive a fit, and then make some labels to be used in the eventual plot.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">germanyFits &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/dlply">dlply</a></span>(germanyForPlotting, .(variable), <span class="cf">function</span>(x) <span class="kw">lm</span>(value <span class="op">~</span><span class="st"> </span>Diversity, <span class="dt">data=</span>x))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">germanyLabels &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">levels</span>(germanyForPlotting<span class="op">$</span>variable), </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                            <span class="dt">Diversity=</span><span class="dv">7</span>, <span class="dt">value=</span><span class="kw">c</span>(<span class="dv">2000</span>, <span class="dv">1200</span>, <span class="fl">1.5</span>, <span class="dv">6</span>, <span class="dv">20</span>), </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                            <span class="dt">lab=</span><span class="kw">paste</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], <span class="st">")"</span>, <span class="dt">sep=</span><span class="st">""</span>),</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                            <span class="dt">r2 =</span> <span class="kw">sapply</span>(germanyFits, <span class="cf">function</span>(x) <span class="kw">summary</span>(x)<span class="op">$</span>r.squared),</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                            <span class="dt">p =</span> <span class="kw">sapply</span>(germanyFits, <span class="cf">function</span>(x) <span class="kw">anova</span>(x)[<span class="dv">1</span>,<span class="dv">5</span>])</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">                            )</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">germanyLabels<span class="op">$</span>labels &lt;-<span class="st"> </span><span class="kw">with</span>(germanyLabels, <span class="kw">paste</span>(lab, <span class="st">"p ="</span>, <span class="kw">round</span>(p,<span class="dv">3</span>),<span class="kw">expression</span>(R<span class="op">^</span><span class="dv">2</span>), <span class="st">"="</span>, <span class="kw">round</span>(r2,<span class="dv">2</span>),   <span class="dt">sep=</span><span class="st">" "</span>))</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">germanyLabels<span class="op">$</span>labels &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"p = 0 "</span>, <span class="st">"p &lt; 0.001 "</span>, germanyLabels<span class="op">$</span>labels)</a></code></pre></div>
<p>Finally, we will put it all together into a single plot.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>Diversity, <span class="dt">y=</span>value),<span class="dt">data=</span>germanyForPlotting) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">size=</span><span class="dv">3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>variable, <span class="dt">scales=</span><span class="st">"free"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">15</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">stat_smooth</a></span>(<span class="dt">method=</span><span class="st">"lm"</span>, <span class="dt">colour=</span><span class="st">"black"</span>, <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Species Richness"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Value of Function</span><span class="ch">\n</span><span class="st">"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_text">geom_text</a></span>(<span class="dt">data=</span>germanyLabels,</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">            <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">label=</span>labels)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">panel.grid =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>())</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-7-1.png" width="1152"></p>
<p>Next, we ask whether the best performing species differs between functions. To do that, we have to pull out all monoculture plots, then reshape the data and run a quick qualitative analysis on it to determine the best performer.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#pull out only those plots planted in monoculture</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">monoGermany&lt;-<span class="st"> </span><span class="kw">subset</span>(germany, <span class="kw">rowSums</span>(germany[,spIDX])<span class="op">==</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#figure out which monoculture is which</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">monoGermany<span class="op">$</span>mono&lt;-<span class="kw">apply</span>(monoGermany[,spIDX], <span class="dv">1</span>, <span class="cf">function</span>(x) species[<span class="kw">which</span>(x<span class="op">==</span><span class="dv">1</span>)])</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#melt by function for easier analysis</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">monoGermanyMelt&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/reshape2/topics/melt">melt</a></span>(monoGermany[,<span class="kw">c</span>(<span class="kw">ncol</span>(monoGermany),<span class="kw">which</span>(<span class="kw">names</span>(monoGermany) <span class="op">%in%</span><span class="st"> </span>vars))], <span class="dt">id.vars=</span><span class="st">"mono"</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#get the mean for each monoculture that has &gt;1 replicate</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">monoGermanyMelt &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ddply">ddply</a></span>(monoGermanyMelt, .(variable, mono), summarize, <span class="dt">value=</span><span class="kw">mean</span>(value))</a>
<a class="sourceLine" id="cb8-12" data-line-number="12"></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#now, who is the best performer?</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ddply">ddply</a></span>(monoGermanyMelt, .(variable), summarize, <span class="dt">maxMono=</span>mono[<span class="kw">which</span>(value<span class="op">==</span><span class="kw">max</span>(value, <span class="dt">na.rm=</span>T))])</a></code></pre></div>
<pre><code>#    variable maxMono
# 1 biomassY3 TRIPRA1
# 2     root3 FESRUB1
# 3   cotton3 TRIREP1
# 4    N.Soil TRIREP1
# 5    N.g.m2 TRIPRA1</code></pre>
</div>
<div id="overlap-approach" class="section level2">
<h2 class="hasAnchor">
<a href="#overlap-approach" class="anchor"></a>Overlap Approach</h2>
<p>One of the functions we are looking at, soil N, first needs to be reflected before we can apply the overlap approach.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">germany<span class="op">$</span>N.Soil&lt;-<span class="st"> </span><span class="dv">-1</span><span class="op">*</span>germany<span class="op">$</span>N.Soil <span class="op">+</span><span class="kw">max</span>(germany<span class="op">$</span>N.Soil, <span class="dt">na.rm=</span>T)</a></code></pre></div>
<p>We can examine any single species and generate coefficient values and ‘effects’ - i.e., whether a species has a positive (1), negative (-1), or neutral (0) effect on a function. Let’s examine this for biomass production in year 3.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">spList&lt;-<span class="kw"><a href="../reference/sAICfun.html">sAICfun</a></span>(<span class="st">"biomassY3"</span>, species, germany)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">spList</a></code></pre></div>
<pre><code># $pos.sp
# [1] "DACGLO1" "FESPRA1" "LATPRA1" "LOTCOR1" "TRIPRA1" "TRIREP1"
# 
# $neg.sp
# [1] "CAMPAT1" "PHLPRA1" "RANACR1"
# 
# $neu.sp
#  [1] "ACHMIL1" "ALOPRA1" "ANTODO1" "ARRELA1" "BROHOR1" "CENJAC1" "CHRLEU1"
#  [8] "CREBIE1" "CYNCRI1" "FESRUB1" "GERPRA1" "HOLLAN1" "KNAARV1" "LEOAUT1"
# [15] "LOLPER1" "LYCFLO1" "PIMMAJ1" "PLALAN1" "RUMACE1" "TAROFF1" "VICCRA1"
# [22] "VICSEP1"
# 
# $functions
# [1] "biomassY3"
# 
# $coefs
#     ACHMIL1     ALOPRA1     ANTODO1     ARRELA1     BROHOR1     CAMPAT1 
#      0.0000      0.0000      0.0000      0.0000      0.0000   -391.5405 
#     CENJAC1     CHRLEU1     CREBIE1     CYNCRI1     DACGLO1     FESPRA1 
#      0.0000      0.0000      0.0000      0.0000    104.6404    135.6735 
#     FESRUB1     GERPRA1     HOLLAN1     KNAARV1     LATPRA1     LEOAUT1 
#      0.0000      0.0000      0.0000      0.0000    248.5566      0.0000 
#     LOLPER1     LOTCOR1     LYCFLO1     PHLPRA1     PIMMAJ1     PLALAN1 
#      0.0000    375.6694      0.0000   -297.7452      0.0000      0.0000 
#     RANACR1     RUMACE1     TAROFF1     TRIPRA1     TRIREP1     VICCRA1 
#   -140.2996      0.0000      0.0000    492.6311    325.0173      0.0000 
#     VICSEP1 (Intercept) 
#      0.0000    335.8382 
# 
# $effects
# ACHMIL1 ALOPRA1 ANTODO1 ARRELA1 BROHOR1 CAMPAT1 CENJAC1 CHRLEU1 CREBIE1 
#       0       0       0       0       0      -1       0       0       0 
# CYNCRI1 DACGLO1 FESPRA1 FESRUB1 GERPRA1 HOLLAN1 KNAARV1 LATPRA1 LEOAUT1 
#       0       1       1       0       0       0       0       1       0 
# LOLPER1 LOTCOR1 LYCFLO1 PHLPRA1 PIMMAJ1 PLALAN1 RANACR1 RUMACE1 TAROFF1 
#       0       1       0      -1       0       0      -1       0       0 
# TRIPRA1 TRIREP1 VICCRA1 VICSEP1 
#       1       1       0       0</code></pre>
<p>Using this as our starting point, we can use the getRedundancy function to generate a) an effect matrix for all functions, b) a coefficient matrix for all functions, and c) a standardized coefficient matrix for all functions.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">redund&lt;-<span class="kw"><a href="../reference/getRedundancy.html">getRedundancy</a></span>(vars, species, germany)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">coefs&lt;-<span class="kw"><a href="../reference/getRedundancy.html">getRedundancy</a></span>(vars, species, germany, <span class="dt">output=</span><span class="st">"coef"</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">stdCoefs&lt;-<span class="kw"><a href="../reference/stdEffects.html">stdEffects</a></span>(coefs, germany, vars, species)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#for example</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">redund</a></code></pre></div>
<pre><code>#           ACHMIL1 ALOPRA1 ANTODO1 ARRELA1 BROHOR1 CAMPAT1 CENJAC1 CHRLEU1
# biomassY3       0       0       0       0       0      -1       0       0
# root3           1       0      -1       0       1       0       0       0
# N.g.m2          1       0       0      -1       0       0       0       0
# N.Soil         -1       0      -1       0       1      -1       0       0
# cotton3         0       1       1       0      -1       1       0       0
#           CREBIE1 CYNCRI1 DACGLO1 FESPRA1 FESRUB1 GERPRA1 HOLLAN1 KNAARV1
# biomassY3       0       0       1       1       0       0       0       0
# root3           0       0       0       0       1       0      -1       0
# N.g.m2         -1       0       0       1       0       0      -1       0
# N.Soil          1       0       1      -1       0       0       0       0
# cotton3         0       0       0       0       0       0       0       0
#           LATPRA1 LEOAUT1 LOLPER1 LOTCOR1 LYCFLO1 PHLPRA1 PIMMAJ1 PLALAN1
# biomassY3       1       0       0       1       0      -1       0       0
# root3           1       0       1       0       0       0       0      -1
# N.g.m2          0       0       1       1       0      -1       0      -1
# N.Soil          1       0       0       1       0       1       0       0
# cotton3        -1       0      -1       0       0       0       0       1
#           RANACR1 RUMACE1 TAROFF1 TRIPRA1 TRIREP1 VICCRA1 VICSEP1
# biomassY3      -1       0       0       1       1       0       0
# root3          -1       0       0      -1       0       0       0
# N.g.m2         -1       0       0       1       1       0       0
# N.Soil          1       0       0      -1      -1       0       0
# cotton3         0       0       0       1       1       0       0</code></pre>
<p>Using the effect matrix, we then estimate the average number of species affecting all possible combinations of functions - both positive and negative - and then plot the results.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">#plot the num. functions by fraction of the species pool needed</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">posCurve&lt;-<span class="kw"><a href="../reference/divNeeded.html">divNeeded</a></span>(redund, <span class="dt">type=</span><span class="st">"positive"</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">posCurve<span class="op">$</span>div&lt;-posCurve<span class="op">$</span>div<span class="op">/</span><span class="kw">ncol</span>(redund)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">pc&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/qplot">qplot</a></span>(nfunc, div, <span class="dt">data=</span>posCurve, <span class="dt">group=</span>nfunc, <span class="dt">geom=</span><span class="kw">c</span>(<span class="st">"boxplot"</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_jitter">geom_jitter</a></span>(<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">position =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/position_jitter">position_jitter</a></span>(<span class="dt">height=</span><span class="fl">0.001</span>, <span class="dt">width =</span> <span class="fl">.04</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Fraction of Species Pool</span><span class="ch">\n</span><span class="st">with Positive Effect</span><span class="ch">\n</span><span class="st">"</span>)<span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of Functions"</span>)<span class="op">+</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">24</span>)<span class="op">+</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">ylim</a></span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb15-8" data-line-number="8"></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"></a>
<a class="sourceLine" id="cb15-10" data-line-number="10">negCurve&lt;-<span class="kw"><a href="../reference/divNeeded.html">divNeeded</a></span>(redund, <span class="dt">type=</span><span class="st">"negative"</span>)</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">negCurve<span class="op">$</span>div&lt;-negCurve<span class="op">$</span>div<span class="op">/</span><span class="kw">ncol</span>(redund)</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">nc&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/qplot">qplot</a></span>(nfunc, div, <span class="dt">data=</span>negCurve, <span class="dt">group=</span>nfunc, <span class="dt">geom=</span><span class="kw">c</span>(<span class="st">"boxplot"</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_jitter">geom_jitter</a></span>(<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">position =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/position_jitter">position_jitter</a></span>(<span class="dt">height=</span><span class="fl">0.001</span>, <span class="dt">width =</span> <span class="fl">.04</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Fraction of Species Pool</span><span class="ch">\n</span><span class="st">with Negative Effect</span><span class="ch">\n</span><span class="st">"</span>)<span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of Functions"</span>)<span class="op">+</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">24</span>)<span class="op">+</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">ylim</a></span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb15-16" data-line-number="16"></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#combine these into one plot</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(pc<span class="op">+</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/annotate">annotate</a></span>(<span class="st">"text"</span>, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span><span class="dv">1</span>, <span class="dt">label=</span><span class="st">"a)"</span>), nc<span class="op">+</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/annotate">annotate</a></span>(<span class="st">"text"</span>, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span><span class="dv">1</span>, <span class="dt">label=</span><span class="st">"b)"</span>), <span class="dt">ncol=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-12-1.png" width="1152"></p>
<p>We could have also looked at overlap indices, such as the Sorenson index.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">allOverlapPos&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ddply">ddply</a></span>(<span class="kw">data.frame</span>(<span class="dt">m=</span><span class="dv">2</span><span class="op">:</span><span class="kw">nrow</span>(redund)), .(m), <span class="cf">function</span>(adf) <span class="kw"><a href="../reference/getOverlapSummary.html">getOverlapSummary</a></span>(redund, <span class="dt">m=</span>adf<span class="op">$</span>m[<span class="dv">1</span>], <span class="dt">denom=</span><span class="st">"set"</span>))</a></code></pre></div>
<p>One we’ve examined the consequences of functional overlap, we can then move on to compare the number and size of these effects. First, what is the relative balance of positive to negative contributions for each species?</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">posNeg&lt;-<span class="kw">data.frame</span>(<span class="dt">Species =</span> <span class="kw">colnames</span>(redund),</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">                   <span class="dt">Pos =</span> <span class="kw">colSums</span>(<span class="kw"><a href="../reference/filterOverData.html">filterOverData</a></span>(redund)),</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">                   <span class="dt">Neg =</span> <span class="kw">colSums</span>(<span class="kw"><a href="../reference/filterOverData.html">filterOverData</a></span>(redund, <span class="dt">type=</span><span class="st">"negative"</span>)))</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#plot it</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>Pos,<span class="dt">y=</span> Neg), <span class="dt">data=</span>posNeg) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_jitter">geom_jitter</a></span>(<span class="dt">position =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/position_jitter">position_jitter</a></span>(<span class="dt">width =</span> <span class="fl">0.05</span>, <span class="dt">height =</span> <span class="fl">0.05</span>), <span class="dt">size=</span><span class="dv">5</span>, <span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">18</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st"># of Positive Contributions per species</span><span class="ch">\n</span><span class="st">"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"# of Negative Contributions per species</span><span class="ch">\n</span><span class="st">"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/annotate">annotate</a></span>(<span class="st">"text"</span>, <span class="dt">x=</span><span class="dv">0</span>, <span class="dt">y=</span><span class="dv">3</span>, <span class="dt">label=</span><span class="st">"a)"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">stat_smooth</a></span>(<span class="dt">method=</span><span class="st">"glm"</span>, <span class="dt">colour=</span><span class="st">"black"</span>, <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">family=</span><span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">"identity"</span>))</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>So, a generally positive relationship. We can see from the figure that the slope is slightly less than 1:1, so positive effects accumulate faster. Still, more positive effects = more negative effects. What about the size of those positive versus negative effects?</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co">#now get the standardized effect sizes</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">posNeg&lt;-<span class="kw">within</span>(posNeg, {</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  stdPosMean &lt;-<span class="st"> </span><span class="kw">colSums</span>(<span class="kw"><a href="../reference/filterCoefData.html">filterCoefData</a></span>(stdCoefs))<span class="op">/</span>Pos</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">  stdPosMean[<span class="kw">which</span>(<span class="kw">is.nan</span>(stdPosMean))] &lt;-<span class="dv">0</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb18-7" data-line-number="7">  stdNegMean &lt;-<span class="st"> </span><span class="kw">colSums</span>(<span class="kw"><a href="../reference/filterCoefData.html">filterCoefData</a></span>(stdCoefs, <span class="dt">type=</span><span class="st">"negative"</span>))<span class="op">/</span>Neg</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">  stdNegMean[<span class="kw">which</span>(<span class="kw">is.nan</span>(stdNegMean))] &lt;-<span class="dv">0</span>  </a>
<a class="sourceLine" id="cb18-9" data-line-number="9">})</a>
<a class="sourceLine" id="cb18-10" data-line-number="10"></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>stdPosMean,<span class="dt">y=</span> stdNegMean), <span class="dt">data=</span>posNeg) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="st">  </span><span class="co">#  geom_point(size=3) +</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_jitter">geom_jitter</a></span>(<span class="dt">position =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/position_jitter">position_jitter</a></span>(<span class="dt">width =</span> <span class="fl">.02</span>, <span class="dt">height =</span> <span class="fl">.02</span>), <span class="dt">size=</span><span class="dv">5</span>, <span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">18</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Average Standardized Size of</span><span class="ch">\n</span><span class="st">Positive Contributions"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Average Standardized Size of</span><span class="ch">\n</span><span class="st">Negative Contributions</span><span class="ch">\n</span><span class="st">"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">stat_smooth</a></span>(<span class="dt">method=</span><span class="st">"lm"</span>, <span class="dt">colour=</span><span class="st">"black"</span>, <span class="dt">size=</span><span class="dv">2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/annotate">annotate</a></span>(<span class="st">"text"</span>, <span class="dt">x=</span><span class="dv">0</span>, <span class="dt">y=</span><span class="fl">0.25</span>, <span class="dt">label=</span><span class="st">"b)"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_abline</a></span>(<span class="dt">slope=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">colour=</span><span class="st">"black"</span>, <span class="dt">lty=</span><span class="dv">3</span>)</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div id="averaging-approach" class="section level2">
<h2 class="hasAnchor">
<a href="#averaging-approach" class="anchor"></a>Averaging Approach</h2>
<p>Now we’ll try the averaging approach. The first step is to create a set of columns where we have standardized all of the functions of interest, and then create an average of those standardized functions.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">#add on the new functions along with the averaged multifunctional index</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">germany&lt;-<span class="kw">cbind</span>(germany, <span class="kw"><a href="../reference/getStdAndMeanFunctions.html">getStdAndMeanFunctions</a></span>(germany, vars))</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#germany&lt;-cbind(germany, getStdAndMeanFunctions(germany, vars, standardizeZScore))</span></a></code></pre></div>
<p>We can then plot the averaged multifunctionality quite simply</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co">#plot it</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>Diversity, <span class="dt">y=</span>meanFunction),<span class="dt">data=</span>germany)<span class="op">+</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">size=</span><span class="dv">3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">15</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">stat_smooth</a></span>(<span class="dt">method=</span><span class="st">"lm"</span>, <span class="dt">colour=</span><span class="st">"black"</span>, <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Species Richness"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Average Value of Standardized Functions</span><span class="ch">\n</span><span class="st">"</span>)</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>We may want to look at all of the functions on a standardized scale, and add in the averaged line for comparison as well. We can do this by reshaping the data, and plotting it.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co">#reshape for plotting everything with ggplot2</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">germanyMeanForPlotting&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/reshape2/topics/melt">melt</a></span>(germany[,<span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">129</span><span class="op">:</span><span class="dv">134</span>)], <span class="dt">id.vars=</span><span class="st">"Diversity"</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co">#nice names for plotting</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="kw">levels</span>(germanyMeanForPlotting<span class="op">$</span>variable) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'Aboveground Biomass'</span>, <span class="st">'Root Biomass'</span>, <span class="st">'Cotton Decomposition'</span>, <span class="st">'Soil Nitrogen'</span>, <span class="st">'Plant Nitrogen'</span>, <span class="st">'Mean Multifuncion Index'</span>)</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co">#plot it</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>Diversity, <span class="dt">y=</span>value),<span class="dt">data=</span>germanyMeanForPlotting)<span class="op">+</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">size=</span><span class="dv">3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_grid">facet_grid</a></span>(<span class="op">~</span>variable) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">15</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">stat_smooth</a></span>(<span class="dt">method=</span><span class="st">"lm"</span>, <span class="dt">colour=</span><span class="st">"black"</span>, <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Species Richness"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Standardized Value of Function</span><span class="ch">\n</span><span class="st">"</span>)</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-18-1.png" width="1536"></p>
<p>Last, let’s test the statistical fit of the effect of diversity on the averaged multifunctionality index.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co">#statistical fit</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">aveFit&lt;-<span class="kw">lm</span>(meanFunction <span class="op">~</span><span class="st"> </span>Diversity, <span class="dt">data=</span>germany)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/car/topics/Anova">Anova</a></span>(aveFit)</a></code></pre></div>
<pre><code># Anova Table (Type II tests)
# 
# Response: meanFunction
#            Sum Sq Df F value    Pr(&gt;F)    
# Diversity 0.29502  1   32.63 4.042e-07 ***
# Residuals 0.52440 58                      
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">summary</span>(aveFit)</a></code></pre></div>
<pre><code># 
# Call:
# lm(formula = meanFunction ~ Diversity, data = germany)
# 
# Residuals:
#       Min        1Q    Median        3Q       Max 
# -0.200533 -0.069321  0.006506  0.062717  0.288942 
# 
# Coefficients:
#             Estimate Std. Error t value Pr(&gt;|t|)    
# (Intercept) 0.385422   0.017049  22.606  &lt; 2e-16 ***
# Diversity   0.015360   0.002689   5.712 4.04e-07 ***
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
# 
# Residual standard error: 0.09509 on 58 degrees of freedom
# Multiple R-squared:   0.36,   Adjusted R-squared:  0.349 
# F-statistic: 32.63 on 1 and 58 DF,  p-value: 4.042e-07</code></pre>
</div>
<div id="threshold-approach" class="section level2">
<h2 class="hasAnchor">
<a href="#threshold-approach" class="anchor"></a>Threshold Approach</h2>
<p>First, we need to create a new data set that looks at the number of functions greater than or equal to a threshold across a wide range of thresholds.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">germanyThresh&lt;-<span class="kw"><a href="../reference/getFuncsMaxed.html">getFuncsMaxed</a></span>(germany, vars, <span class="dt">threshmin=</span><span class="fl">0.05</span>, <span class="dt">threshmax=</span><span class="fl">0.99</span>, <span class="dt">prepend=</span><span class="kw">c</span>(<span class="st">"plot"</span>,<span class="st">"Diversity"</span>), <span class="dt">maxN=</span><span class="dv">7</span>)</a></code></pre></div>
<p>Next, let’s perform an analysis on just the 0.8 threshold data.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">mfuncGermanyLinear08&lt;-<span class="kw">glm</span>(funcMaxed <span class="op">~</span><span class="st"> </span>Diversity, <span class="dt">data=</span><span class="kw">subset</span>(germanyThresh, germanyThresh<span class="op">$</span>thresholds<span class="op">==</span><span class="st">"0.8"</span>), <span class="dt">family=</span><span class="kw">quasipoisson</span>(<span class="dt">link=</span><span class="st">"identity"</span>))</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/car/topics/Anova">Anova</a></span>(mfuncGermanyLinear08, <span class="dt">test.statistic=</span><span class="st">"F"</span>)</a></code></pre></div>
<pre><code># Analysis of Deviance Table (Type II tests)
# 
# Response: funcMaxed
# Error estimate based on Pearson residuals 
# 
#           Sum Sq Df F value   Pr(&gt;F)   
# Diversity  8.947  1  10.512 0.001968 **
# Residuals 49.364 58                    
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">summary</span>(mfuncGermanyLinear08)</a></code></pre></div>
<pre><code># 
# Call:
# glm(formula = funcMaxed ~ Diversity, family = quasipoisson(link = "identity"), 
#     data = subset(germanyThresh, germanyThresh$thresholds == 
#         "0.8"))
# 
# Deviance Residuals: 
#      Min        1Q    Median        3Q       Max  
# -1.92228  -1.15215  -0.02578   0.50067   2.09248  
# 
# Coefficients:
#             Estimate Std. Error t value Pr(&gt;|t|)    
# (Intercept)  0.49460    0.13928   3.551 0.000769 ***
# Diversity    0.08456    0.03020   2.800 0.006938 ** 
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
# 
# (Dispersion parameter for quasipoisson family taken to be 0.8511272)
# 
#     Null deviance: 67.249  on 59  degrees of freedom
# Residual deviance: 58.302  on 58  degrees of freedom
# AIC: NA
# 
# Number of Fisher Scoring iterations: 4</code></pre>
<p>To get a better sense of how robust these results are to threshold choice, let’s plot the diversity versus number of functions greater than or equal to a threshold for four different thresholds.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">gcPlot&lt;-<span class="kw">subset</span>(germanyThresh, germanyThresh<span class="op">$</span>thresholds <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="../reference/qw.html">qw</a></span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="co">#note, using qw as %in% is a string comparison operator</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">gcPlot<span class="op">$</span>percent&lt;-<span class="kw">paste</span>(<span class="dv">100</span><span class="op">*</span>gcPlot<span class="op">$</span>thresholds, <span class="st">"%"</span>, <span class="dt">sep=</span><span class="st">""</span>)</a>
<a class="sourceLine" id="cb31-4" data-line-number="4"></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/qplot">qplot</a></span>(Diversity, funcMaxed, <span class="dt">data=</span>gcPlot, <span class="dt">facets=</span><span class="op">~</span>percent) <span class="op">+</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">stat_smooth</a></span>(<span class="dt">method=</span><span class="st">"glm"</span>, <span class="dt">family=</span><span class="kw">quasipoisson</span>(<span class="dt">link=</span><span class="st">"identity"</span>), <span class="dt">colour=</span><span class="st">"red"</span>, <span class="dt">lwd=</span><span class="fl">1.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="kw">expression</span>(<span class="st">"Number of Functions"</span> <span class="op">&gt;=</span><span class="st"> </span>Threshold)) <span class="op">+</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Species Richness"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb31-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">14</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb31-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_text">geom_text</a></span>(<span class="dt">data=</span><span class="kw">data.frame</span>(<span class="dt">percent =</span> <span class="kw">unique</span>(gcPlot<span class="op">$</span>percent),</a>
<a class="sourceLine" id="cb31-11" data-line-number="11">                       <span class="dt">lab =</span> <span class="kw">paste</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="st">")"</span>, <span class="dt">sep=</span><span class="st">""</span>),</a>
<a class="sourceLine" id="cb31-12" data-line-number="12">                       <span class="dt">Diversity=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb31-13" data-line-number="13">                       <span class="dt">funcMaxed=</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb31-14" data-line-number="14">                       ), <span class="dt">mapping=</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>Diversity, <span class="dt">y=</span>funcMaxed, <span class="dt">label=</span>lab))</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Given that variation, let’s look at the entire spread of thresholds.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">germanyThresh<span class="op">$</span>percent &lt;-<span class="st"> </span><span class="dv">100</span><span class="op">*</span>germanyThresh<span class="op">$</span>thresholds</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data=</span>germanyThresh, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>Diversity, <span class="dt">y=</span>funcMaxed, <span class="dt">group=</span>percent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="kw">expression</span>(<span class="st">"Number of Functions"</span> <span class="op">&gt;=</span><span class="st"> </span>Threshold)) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Species Richness"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">stat_smooth</a></span>(<span class="dt">method=</span><span class="st">"glm"</span>, <span class="dt">family=</span><span class="kw">quasipoisson</span>(<span class="dt">link=</span><span class="st">"identity"</span>), <span class="dt">lwd=</span><span class="fl">0.8</span>, <span class="dt">fill=</span><span class="ot">NA</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">color=</span>percent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">14</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_gradient">scale_color_gradient</a></span>(<span class="dt">name=</span><span class="st">"Percent of </span><span class="ch">\n</span><span class="st">Maximum"</span>, <span class="dt">low=</span><span class="st">"blue"</span>, <span class="dt">high=</span><span class="st">"red"</span>)</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div id="multiple-threshold-approach" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-threshold-approach" class="anchor"></a>Multiple Threshold Approach</h2>
<p>To systematically explore the variation in the relationship based on threshold choice, let’s look at the slope of the relationship and its confidence interval over all thresholds. We will then plot this relationship.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">germanyLinearSlopes&lt;-<span class="kw"><a href="../reference/getCoefTab.html">getCoefTab</a></span>(funcMaxed <span class="op">~</span><span class="st"> </span>Diversity, <span class="dt">data=</span>germanyThresh, <span class="dt">coefVar=</span><span class="st">"Diversity"</span>, <span class="dt">family=</span><span class="kw">quasipoisson</span>(<span class="dt">link=</span><span class="st">"identity"</span>))</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"></a>
<a class="sourceLine" id="cb33-4" data-line-number="4">######</a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="co"># Plot the values of the diversity slope at</span></a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="co"># different levels of the threshold</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7">######</a>
<a class="sourceLine" id="cb33-8" data-line-number="8">germanSlopes &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(germanyLinearSlopes, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>thresholds)) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">fill=</span><span class="st">"grey50"</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>thresholds<span class="op">*</span><span class="dv">100</span>, <span class="dt">ymin=</span>Estimate<span class="fl">-1.96</span><span class="op">*</span>germanyLinearSlopes[[<span class="st">"Std. Error"</span>]], </a>
<a class="sourceLine" id="cb33-10" data-line-number="10">                                  <span class="dt">ymax=</span>Estimate<span class="fl">+1.96</span><span class="op">*</span>germanyLinearSlopes[[<span class="st">"Std. Error"</span>]])) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>thresholds<span class="op">*</span><span class="dv">100</span>, <span class="dt">y=</span>Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Change in Number of Functions per Addition of 1 Species</span><span class="ch">\n</span><span class="st">"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Threshold (%)"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_abline</a></span>(<span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">0</span>, <span class="dt">lwd=</span><span class="dv">1</span>, <span class="dt">linetype=</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">14</span>)</a>
<a class="sourceLine" id="cb33-16" data-line-number="16"></a>
<a class="sourceLine" id="cb33-17" data-line-number="17">germanSlopes</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-24-1.png" width="1152"></p>
<p>We can easily see a number of indices mentioned in the text - Tmin, Tmax, Tmde, etc. Let’s pull them out with our indices function.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">germanIDX &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getIndices.html">getIndices</a></span>(germanyLinearSlopes, germanyThresh, funcMaxed <span class="op">~</span><span class="st"> </span>Diversity)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">germanIDX</a></code></pre></div>
<pre><code>#     Tmin Tmax Tmde Rmde.linear Pmde.linear     Mmin     Mmax     Mmde
# 542 0.14 0.91 0.48    0.168293   0.5385377 5.056142 1.173544 4.429463
#     nFunc
# 542     5</code></pre>
<p>We can now add annotations to our earlier plot to make it more rich, and show us those crucial threshold values.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">germanyLinearSlopes<span class="op">$</span>Estimate[<span class="kw">which</span>(germanyLinearSlopes<span class="op">$</span>thresholds<span class="op">==</span>germanIDX<span class="op">$</span>Tmde)]</a></code></pre></div>
<pre><code># [1] 0.168293</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">germanyThresh<span class="op">$</span>IDX &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2">germanyThresh<span class="op">$</span>IDX [<span class="kw">which</span>(germanyThresh<span class="op">$</span>thresholds <span class="op">%in%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="st">                           </span><span class="kw">c</span>(germanIDX<span class="op">$</span>Tmin, germanIDX<span class="op">$</span>Tmax, germanIDX<span class="op">$</span>Tmde))] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb38-4" data-line-number="4"></a>
<a class="sourceLine" id="cb38-5" data-line-number="5"></a>
<a class="sourceLine" id="cb38-6" data-line-number="6"></a>
<a class="sourceLine" id="cb38-7" data-line-number="7"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data=</span>germanyThresh, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>Diversity, <span class="dt">y=</span>funcMaxed, <span class="dt">group=</span>percent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="kw">expression</span>(<span class="st">"Number of Functions"</span> <span class="op">&gt;=</span><span class="st"> </span>Threshold)) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Species Richness"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">geom_smooth</a></span>(<span class="dt">method=</span><span class="st">"glm"</span>, <span class="dt">family=</span><span class="kw">quasipoisson</span>(<span class="dt">link=</span><span class="st">"identity"</span>), </a>
<a class="sourceLine" id="cb38-11" data-line-number="11">              <span class="dt">fill=</span><span class="ot">NA</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">color=</span>percent, <span class="dt">lwd=</span>IDX)) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">14</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_gradient">scale_color_gradient</a></span>(<span class="dt">name=</span><span class="st">"Percent of </span><span class="ch">\n</span><span class="st">Maximum"</span>, <span class="dt">low=</span><span class="st">"blue"</span>, <span class="dt">high=</span><span class="st">"red"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_size">scale_size</a></span>(<span class="dt">range=</span><span class="kw">c</span>(<span class="fl">0.3</span>,<span class="dv">5</span>), <span class="dt">guide=</span><span class="st">"none"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/annotate">annotate</a></span>(<span class="dt">geom=</span><span class="st">"text"</span>, <span class="dt">x=</span><span class="dv">0</span>, <span class="dt">y=</span><span class="kw">c</span>(<span class="fl">0.2</span>,<span class="dv">2</span>,<span class="fl">4.6</span>), <span class="dt">label=</span><span class="kw">c</span>(<span class="st">"Tmax"</span>, <span class="st">"Tmde"</span>, <span class="st">"Tmin"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/annotate">annotate</a></span>(<span class="dt">geom=</span><span class="st">"text"</span>, <span class="dt">x=</span><span class="fl">16.7</span>, <span class="dt">y=</span><span class="kw">c</span>(germanIDX<span class="op">$</span>Mmin, germanIDX<span class="op">$</span>Mmax, germanIDX<span class="op">$</span>Mmde), <span class="dt">label=</span><span class="kw">c</span>(<span class="st">"Mmin"</span>, <span class="st">"Mmax"</span>, <span class="st">"Mmde"</span>))</a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-26-1.png" width="1152"></p>
<p>Or we can see where they are on the curve of slopes at different thresholds.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">germanSlopes <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/annotate">annotate</a></span>(<span class="dt">geom=</span><span class="st">"text"</span>, <span class="dt">y=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.01</span>, <span class="fl">-0.01</span>, <span class="fl">-0.01</span>, germanIDX<span class="op">$</span>Rmde.linear<span class="fl">+0.02</span>), <span class="dt">x=</span><span class="kw">c</span>(germanIDX<span class="op">$</span>Tmin<span class="op">*</span><span class="dv">100</span>, germanIDX<span class="op">$</span>Tmde<span class="op">*</span><span class="dv">100</span>, germanIDX<span class="op">$</span>Tmax<span class="op">*</span><span class="dv">100</span>, germanIDX<span class="op">$</span>Tmde<span class="op">*</span><span class="dv">100</span>),  <span class="dt">label=</span><span class="kw">c</span>(<span class="st">"Tmin"</span>, <span class="st">"Tmde"</span>, <span class="st">"Tmax"</span>, <span class="st">"Rmde"</span>), <span class="dt">color=</span><span class="st">"black"</span>) </a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-27-1.png" width="1152"></p>
</div>
<div id="comparison-of-sites" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-of-sites" class="anchor"></a>Comparison of Sites</h2>
<p>Furthermore, we can extend this to the more of the BIODEPTH dataset to compare the strength of multifunctionality across sites. We begin by loading in the data and calculating slopes at different thresholds. We’ll subset down to Sheffield, Portugal, and Sweden for simplicity, but this could be done for all sites quite easily.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">####</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="co"># Now we will look at the entire BIODEPTH dataset</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="co">#</span></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="co"># Note the use of ddply from plyr to generate the new data frame using all locations from biodepth.</span></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="co"># If you're not using plyr for your data aggregation, you should be.  http://plyr.had.co.nz/</span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="co"># It will save you a lot of time and headaches in the future.</span></a>
<a class="sourceLine" id="cb40-7" data-line-number="7">####</a>
<a class="sourceLine" id="cb40-8" data-line-number="8"></a>
<a class="sourceLine" id="cb40-9" data-line-number="9"><span class="co">#Read in data  to run sample analyses on the biodepth data</span></a>
<a class="sourceLine" id="cb40-10" data-line-number="10"><span class="kw">data</span>(all_biodepth)</a>
<a class="sourceLine" id="cb40-11" data-line-number="11">sub_biodepth&lt;-<span class="kw">subset</span>(all_biodepth, all_biodepth<span class="op">$</span>location <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Sheffield"</span>, <span class="st">"Portugal"</span>, <span class="st">"Sweden"</span>))</a>
<a class="sourceLine" id="cb40-12" data-line-number="12">sub_biodepth<span class="op">$</span>location&lt;-<span class="kw">factor</span>(sub_biodepth<span class="op">$</span>location, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">"Portugal"</span>, <span class="st">"Sweden"</span>, <span class="st">"Sheffield"</span>))</a>
<a class="sourceLine" id="cb40-13" data-line-number="13"></a>
<a class="sourceLine" id="cb40-14" data-line-number="14">allVars&lt;-<span class="kw"><a href="../reference/qw.html">qw</a></span>(biomassY3, root3, N.g.m2,  light3, N.Soil, wood3, cotton3)</a>
<a class="sourceLine" id="cb40-15" data-line-number="15">varIdx&lt;-<span class="kw">which</span>(<span class="kw">names</span>(sub_biodepth) <span class="op">%in%</span><span class="st"> </span>allVars)</a>
<a class="sourceLine" id="cb40-16" data-line-number="16"></a>
<a class="sourceLine" id="cb40-17" data-line-number="17"></a>
<a class="sourceLine" id="cb40-18" data-line-number="18"></a>
<a class="sourceLine" id="cb40-19" data-line-number="19"><span class="co">#re-normalize so that everything is on the same </span></a>
<a class="sourceLine" id="cb40-20" data-line-number="20"><span class="co">#sign-scale (e.g. the maximum level of a function is </span></a>
<a class="sourceLine" id="cb40-21" data-line-number="21"><span class="co">#the "best" function)</span></a>
<a class="sourceLine" id="cb40-22" data-line-number="22">sub_biodepth&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ddply">ddply</a></span>(sub_biodepth, .(location), <span class="cf">function</span>(adf){</a>
<a class="sourceLine" id="cb40-23" data-line-number="23">  adf<span class="op">$</span>light3&lt;-<span class="st"> </span><span class="dv">-1</span><span class="op">*</span>adf<span class="op">$</span>light3<span class="op">+</span><span class="kw">max</span>(adf<span class="op">$</span>light3, <span class="dt">na.rm=</span>T)</a>
<a class="sourceLine" id="cb40-24" data-line-number="24">  adf<span class="op">$</span>N.Soil&lt;-<span class="st"> </span><span class="dv">-1</span><span class="op">*</span>adf<span class="op">$</span>N.Soil <span class="op">+</span><span class="kw">max</span>(adf<span class="op">$</span>N.Soil, <span class="dt">na.rm=</span>T)</a>
<a class="sourceLine" id="cb40-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb40-26" data-line-number="26">  adf</a>
<a class="sourceLine" id="cb40-27" data-line-number="27">})</a>
<a class="sourceLine" id="cb40-28" data-line-number="28"></a>
<a class="sourceLine" id="cb40-29" data-line-number="29"></a>
<a class="sourceLine" id="cb40-30" data-line-number="30"><span class="co">#get thresholds</span></a>
<a class="sourceLine" id="cb40-31" data-line-number="31">bdThreshes&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ddply">ddply</a></span>(sub_biodepth, .(location), <span class="cf">function</span>(x) <span class="kw"><a href="../reference/getFuncsMaxed.html">getFuncsMaxed</a></span>(x, <span class="dt">vars=</span>allVars, <span class="dt">prepend=</span><span class="kw">c</span>(<span class="st">"plot"</span>,<span class="st">"Diversity"</span>), <span class="dt">maxN=</span><span class="dv">8</span>))</a>
<a class="sourceLine" id="cb40-32" data-line-number="32"></a>
<a class="sourceLine" id="cb40-33" data-line-number="33"></a>
<a class="sourceLine" id="cb40-34" data-line-number="34">####look at slopes</a>
<a class="sourceLine" id="cb40-35" data-line-number="35"></a>
<a class="sourceLine" id="cb40-36" data-line-number="36"><span class="co">#note, maxIT argument is due to some fits needing more iterations to converge</span></a>
<a class="sourceLine" id="cb40-37" data-line-number="37">bdLinearSlopes&lt;-<span class="kw"><a href="../reference/getCoefTab.html">getCoefTab</a></span>(funcMaxed <span class="op">~</span><span class="st"> </span>Diversity, <span class="dt">data=</span>bdThreshes, <span class="dt">groupVar=</span><span class="kw">c</span>(<span class="st">"location"</span>, <span class="st">"thresholds"</span>), </a>
<a class="sourceLine" id="cb40-38" data-line-number="38">                           <span class="dt">coefVar=</span><span class="st">"Diversity"</span>, <span class="dt">family=</span><span class="kw">quasipoisson</span>(<span class="dt">link=</span><span class="st">"identity"</span>), <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">maxit=</span><span class="dv">800</span>))</a></code></pre></div>
<p>Great, now we can look at the indices of these three new sites. We’ll add Germany in so we can compare them against the German values.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">indexTable &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">levels</span>(bdLinearSlopes<span class="op">$</span>location), <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">  slopedata &lt;-<span class="st"> </span><span class="kw">subset</span>(bdLinearSlopes, bdLinearSlopes<span class="op">$</span>location<span class="op">==</span>x) </a>
<a class="sourceLine" id="cb41-3" data-line-number="3">  threshdata &lt;-<span class="st"> </span><span class="kw">subset</span>(bdThreshes, bdThreshes<span class="op">$</span>location<span class="op">==</span>x) </a>
<a class="sourceLine" id="cb41-4" data-line-number="4">  ret &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getIndices.html">getIndices</a></span>(slopedata, threshdata, funcMaxed <span class="op">~</span><span class="st"> </span>Diversity)</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">  ret&lt;-<span class="kw">cbind</span>(<span class="dt">location=</span>x, ret)</a>
<a class="sourceLine" id="cb41-6" data-line-number="6">  ret</a>
<a class="sourceLine" id="cb41-7" data-line-number="7">})</a>
<a class="sourceLine" id="cb41-8" data-line-number="8">indexTable &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ldply">ldply</a></span>(indexTable)</a>
<a class="sourceLine" id="cb41-9" data-line-number="9"></a>
<a class="sourceLine" id="cb41-10" data-line-number="10">indexTable &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">location=</span><span class="st">"Germany"</span>, germanIDX), indexTable)</a>
<a class="sourceLine" id="cb41-11" data-line-number="11"></a>
<a class="sourceLine" id="cb41-12" data-line-number="12"></a>
<a class="sourceLine" id="cb41-13" data-line-number="13">indexTable</a></code></pre></div>
<pre><code>#      location Tmin Tmax Tmde Rmde.linear Pmde.linear     Mmin     Mmax
# 542   Germany 0.14 0.91 0.48   0.1682930   0.5385377 5.056142 1.173544
# 1    Portugal 0.08 0.45 0.29   0.2166689   0.5055607 6.124575 3.926849
# 2      Sweden   NA 0.71 0.43   0.2676730   0.5353460       NA 2.176587
# 3   Sheffield 0.57   NA 0.76   0.1911508   0.5734523 4.259683       NA
#         Mmde nFunc
# 542 4.429463     5
# 1   6.452464     6
# 2   4.775775     6
# 3   3.937500     4</code></pre>
<p>Finally, let’s compare a visualization of the relevant curves at different thresholds to the relationship between threshold and slope of curve to give the table of numbers some visual meaning.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2"></a>
<a class="sourceLine" id="cb43-3" data-line-number="3">bdCurvesAll&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/qplot">qplot</a></span>(Diversity, funcMaxed, <span class="dt">data=</span>bdThreshes, <span class="dt">group=</span>thresholds, <span class="dt">alpha=</span><span class="kw">I</span>(<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>location)<span class="op">+</span><span class="co">#, scales="free") +</span></a>
<a class="sourceLine" id="cb43-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_gradient">scale_color_gradient</a></span>(<span class="dt">low=</span><span class="st">"blue"</span>, <span class="dt">high=</span><span class="st">"red"</span>, <span class="dt">name=</span><span class="st">"Proportion of </span><span class="ch">\n</span><span class="st">Maximum"</span>, <span class="dt">guide=</span><span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">stat_smooth</a></span>(<span class="dt">method=</span><span class="st">"glm"</span>, <span class="dt">lwd=</span><span class="fl">0.8</span>, <span class="dt">fill=</span><span class="ot">NA</span>, <span class="dt">family=</span><span class="kw">gaussian</span>(<span class="dt">link=</span><span class="st">"identity"</span>), <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">maxit=</span><span class="dv">200</span>), <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">color=</span>thresholds)) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of Functions ≥ Threshold</span><span class="ch">\n\n</span><span class="st">"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Species Richness"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">15</span>)  <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb43-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_text">geom_text</a></span>(<span class="dt">data=</span><span class="kw">data.frame</span>(<span class="dt">location =</span> <span class="kw">levels</span>(bdThreshes<span class="op">$</span>location), <span class="dt">lab =</span> <span class="kw">paste</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="st">")"</span>, <span class="dt">sep=</span><span class="st">""</span>), <span class="dt">thresholds=</span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)), <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span><span class="dv">7</span>, <span class="dt">mapping=</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">label=</span>lab))</a>
<a class="sourceLine" id="cb43-11" data-line-number="11"></a>
<a class="sourceLine" id="cb43-12" data-line-number="12"></a>
<a class="sourceLine" id="cb43-13" data-line-number="13"></a>
<a class="sourceLine" id="cb43-14" data-line-number="14"><span class="co">#Plot it!</span></a>
<a class="sourceLine" id="cb43-15" data-line-number="15">slopePlot&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(bdLinearSlopes, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>thresholds, <span class="dt">y=</span>Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">fill=</span><span class="st">"grey50"</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>( <span class="dt">x=</span>thresholds<span class="op">*</span><span class="dv">100</span>,<span class="dt">ymin=</span>Estimate<span class="dv">-2</span><span class="op">*</span>bdLinearSlopes[[<span class="st">"Std. Error"</span>]], </a>
<a class="sourceLine" id="cb43-17" data-line-number="17">                                  <span class="dt">ymax=</span>Estimate<span class="op">+</span><span class="dv">2</span><span class="op">*</span>bdLinearSlopes[[<span class="st">"Std. Error"</span>]])) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>thresholds<span class="op">*</span><span class="dv">100</span>, <span class="dt">y=</span>Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Change in Number of Functions </span><span class="ch">\n</span><span class="st">per Addition of 1 Species</span><span class="ch">\n</span><span class="st">"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Threshold (%)"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>location)<span class="op">+</span><span class="co">#, scale="free") +</span></a>
<a class="sourceLine" id="cb43-22" data-line-number="22"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_abline</a></span>(<span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">0</span>, <span class="dt">lwd=</span><span class="fl">0.6</span>, <span class="dt">linetype=</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb43-23" data-line-number="23"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size=</span><span class="dv">15</span>)<span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb43-24" data-line-number="24"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_text">geom_text</a></span>(<span class="dt">data=</span><span class="kw">data.frame</span>(<span class="dt">location =</span> <span class="kw">levels</span>(bdThreshes<span class="op">$</span>location), </a>
<a class="sourceLine" id="cb43-25" data-line-number="25">                            <span class="dt">lab =</span> <span class="kw">paste</span>(letters[<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>], <span class="st">")"</span>, <span class="dt">sep=</span><span class="st">""</span>), </a>
<a class="sourceLine" id="cb43-26" data-line-number="26">                            <span class="dt">thresholds=</span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)), <span class="dt">x=</span><span class="fl">0.05</span>, <span class="dt">y=</span><span class="fl">0.27</span>, <span class="dt">mapping=</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">label=</span>lab))</a>
<a class="sourceLine" id="cb43-27" data-line-number="27"></a>
<a class="sourceLine" id="cb43-28" data-line-number="28"></a>
<a class="sourceLine" id="cb43-29" data-line-number="29">###Plot them in a single figure</a>
<a class="sourceLine" id="cb43-30" data-line-number="30"><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(bdCurvesAll,</a>
<a class="sourceLine" id="cb43-31" data-line-number="31">             slopePlot) </a></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-30-1.png" width="960"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#using-the-multifunc-package-for-analysis-of-biodiversity-ecosystem-multifunctionality-relationships-in-the-biodepth-experiment">Using the <em>multifunc</em> package for analysis of Biodiversity Ecosystem Multifunctionality Relationships in the BIODEPTH Experiment</a><ul class="nav nav-pills nav-stacked">
<li><a href="#single-function-approach">Single Function Approach</a></li>
      <li><a href="#overlap-approach">Overlap Approach</a></li>
      <li><a href="#averaging-approach">Averaging Approach</a></li>
      <li><a href="#threshold-approach">Threshold Approach</a></li>
      <li><a href="#multiple-threshold-approach">Multiple Threshold Approach</a></li>
      <li><a href="#comparison-of-sites">Comparison of Sites</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jarrett Byrnes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
