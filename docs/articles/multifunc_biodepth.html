<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assessing Multifunctionality with the multifunc package â€¢ multifunc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Assessing Multifunctionality with the multifunc package">
<meta property="og:description" content="multifunc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multifunc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/multifunc_biodepth.html">Assessing Multifunctionality with the multifunc package</a>
    </li>
    <li>
      <a href="../articles/multifunc_eff_num_func.html">Effective number of functions with multifunc</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jebyrnes/multifunc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Assessing Multifunctionality with the multifunc
package</h1>
                        <h4 data-toc-skip class="author">Jarrett
Byrnes</h4>
            
            <h4 data-toc-skip class="date">2015-06-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jebyrnes/multifunc/blob/HEAD/vignettes/multifunc_biodepth.Rmd" class="external-link"><code>vignettes/multifunc_biodepth.Rmd</code></a></small>
      <div class="hidden name"><code>multifunc_biodepth.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>This is a step-by-step walk-through of the analysis of the German
BIODEPTH site in the paper to illustrate the different analyses we
conducted to evaluate the relationship between biodiversity and
ecosystem multifunctionality.</p>
<p>We begin by loading the <em>multifunc</em> package. If it is not
currently installed, it can be found on github, and installed using the
<em>devtools</em> library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span>
<span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"multifunc"</span>, username<span class="op">=</span><span class="st">"jebyrnes"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jebyrnes.github.io/multifunc/" class="external-link">multifunc</a></span><span class="op">)</span>

<span class="co">#for plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span>

<span class="co">#for data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org" class="external-link">forcats</a></span><span class="op">)</span>

<span class="co">#for analysus</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/" class="external-link">car</a></span><span class="op">)</span></code></pre></div>
<p>Next, we load in the BIODEPTH data. We use some of the helper
functions in the package to identify the column numbers of the relevant
functions for later use.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Read in data  to run sample analyses on the biodepth data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">all_biodepth</span><span class="op">)</span>

<span class="va">allVars</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biomassY3"</span>, <span class="st">"root3"</span>, <span class="st">"N.g.m2"</span>,  <span class="st">"light3"</span>, <span class="st">"N.Soil"</span>, <span class="st">"wood3"</span>, <span class="st">"cotton3"</span><span class="op">)</span>

<span class="va">varIdx</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">all_biodepth</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">allVars</span><span class="op">)</span></code></pre></div>
<p>As we want to work with just the German data, we next subset down the
data to just Germany. We then look at the whether species were seeded or
not, and determine which species were indeed seeded in Germany. If a
column of species is full of zeroes, then it was not seeded in these
plots. We will need the column indices of relevant species for later use
in the overlap analyses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#######</span>
<span class="co">#Now, specify what data we're working with - Germany</span>
<span class="co">#and the relevant variables we'll be working with</span>
<span class="co">#######</span>
<span class="va">germany</span><span class="op">&lt;-</span> <span class="va">all_biodepth</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span><span class="op">==</span><span class="st">"Germany"</span><span class="op">)</span>


<span class="co"># which variables have &gt; 2/3 of the values not NA?</span>
<span class="va">german_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/whichVars.html">whichVars</a></span><span class="op">(</span><span class="va">germany</span>, <span class="va">allVars</span><span class="op">)</span>

<span class="co"># What are the names of species in this dataset</span>
<span class="co"># that have at least some values &gt; 0?</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relevantSp.html">relevantSp</a></span><span class="op">(</span><span class="va">germany</span>,<span class="fl">26</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">germany</span><span class="op">)</span><span class="op">)</span>

<span class="va">spIDX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">germany</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">species</span><span class="op">)</span> <span class="co">#in case we need these</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="single-function-approach">Single Function Approach<a class="anchor" aria-label="anchor" href="#single-function-approach"></a>
</h2>
<p>First, we will demonstrate the qualitative single function approach.
As weâ€™re using <em>ggplot2</em> for plotting, weâ€™ll use <em>tidyr</em>
to pivot the data long for a nice faceted plot of each relationship.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanyForPlotting</span> <span class="op">&lt;-</span> <span class="va">germany</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Diversity</span>, <span class="va">german_vars</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">german_vars</span>,
               names_to <span class="op">=</span> <span class="st">"variable"</span>,
               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span>


<span class="co">#make the levels of the functions into something nice for plots</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">germanyForPlotting</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Aboveground Biomass'</span>, <span class="st">'Root Biomass'</span>, <span class="st">'Cotton Decomposition'</span>, <span class="st">'Soil Nitrogen'</span>, <span class="st">'Plant Nitrogen'</span><span class="op">)</span></code></pre></div>
<p>Nest, as we want to display additional information about the fit of
diversity to each function, weâ€™ll need to iterate over each function,
derive a fit, and then make some labels to be used in the eventual
plot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanyLabels</span> <span class="op">&lt;-</span> <span class="va">germanyForPlotting</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fits <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">Diversity</span>, data<span class="op">=</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span>,
         stats <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fits</span>, <span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"p = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">p.value</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">", "</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">R</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="st">" = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r.squared</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
         labels <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"p = 0 "</span>, <span class="st">"p &lt; 0.001 "</span>, <span class="va">labels</span><span class="op">)</span>,
         Diversity <span class="op">=</span> <span class="fl">7</span>, 
         value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">1200</span>, <span class="fl">1.5</span>, <span class="fl">6</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>
<span class="co">#   </span>
<span class="co"># </span>
<span class="co"># germanyFits &lt;- dlply(germanyForPlotting, .(variable), function(x) lm(value ~ Diversity, data=x))</span>
<span class="co"># germanyLabels &lt;- data.frame(variable = levels(germanyForPlotting$variable), </span>
<span class="co">#                             Diversity=7, value=c(2000, 1200, 1.5, 6, 20), </span>
<span class="co">#                             lab=paste(letters[1:5], ")", sep=""),</span>
<span class="co">#                             r2 = sapply(germanyFits, function(x) summary(x)$r.squared),</span>
<span class="co">#                             p = sapply(germanyFits, function(x) anova(x)[1,5])</span>
<span class="co">#                             )</span>
<span class="co"># </span>
<span class="co"># germanyLabels$labels &lt;- with(germanyLabels, paste(lab, "p =", round(p,3),expression(R^2), "=", round(r2,2),   sep=" "))</span>
<span class="co"># germanyLabels$labels &lt;- gsub("p = 0 ", "p &lt; 0.001 ", germanyLabels$labels)</span></code></pre></div>
<p>Finally, we will put it all together into a single plot.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Diversity</span>, y<span class="op">=</span><span class="va">value</span><span class="op">)</span>,data<span class="op">=</span><span class="va">germanyForPlotting</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, colour<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Species Richness"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Value of Function"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">germanyLabels</span>,
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-7-1.png" width="1152"></p>
<p>Next, we ask whether the best performing species differs between
functions. To do that, we have to pull out all monoculture plots, then
reshape the data and run a quick qualitative analysis on it to determine
the best performer.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#pull out only those plots planted in monoculture</span>
<span class="va">monoGermany</span><span class="op">&lt;-</span> <span class="va">germany</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">ACHMIL1</span><span class="op">:</span><span class="va">VICTET1</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="co">#get mono names</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">ACHMIL1</span><span class="op">:</span><span class="va">VICTET1</span>,
               names_to <span class="op">=</span> <span class="st">"mono"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
<span class="co">#pivot by function</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">german_vars</span>,
               names_to <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  
<span class="co">#get the mean for each monoculture</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">mono</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
  
<span class="co">#now, who is the best performer?</span>
<span class="va">monoGermany</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<pre><code><span class="co"># <span style="color: #949494;"># A tibble: 5 Ã— 3</span></span>
<span class="co"># <span style="color: #949494;"># Groups:   variable [5]</span></span>
<span class="co">#   variable  mono       value</span>
<span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co"># <span style="color: #BCBCBC;">1</span> biomassY3 TRIPRA1  818.   </span>
<span class="co"># <span style="color: #BCBCBC;">2</span> cotton3   TRIREP1    0.854</span>
<span class="co"># <span style="color: #BCBCBC;">3</span> N.g.m2    TRIPRA1   16.9  </span>
<span class="co"># <span style="color: #BCBCBC;">4</span> N.Soil    TRIREP1    4.81 </span>
<span class="co"># <span style="color: #BCBCBC;">5</span> root3     FESRUB1 <span style="text-decoration: underline;">1</span>072.</span></code></pre>
</div>
<div class="section level2">
<h2 id="overlap-approach">Overlap Approach<a class="anchor" aria-label="anchor" href="#overlap-approach"></a>
</h2>
<p>One of the functions we are looking at, soil N, first needs to be
reflected before we can apply the overlap approach.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germany</span> <span class="op">&lt;-</span> <span class="va">germany</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>N.Soil <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">N.Soil</span> <span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">N.Soil</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can examine any single species and generate coefficient values and
â€˜effectsâ€™ - i.e., whether a species has a positive (1), negative (-1),
or neutral (0) effect on a function. Letâ€™s examine this for biomass
production in year 3.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spList</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/sAICfun.html">sAICfun</a></span><span class="op">(</span><span class="st">"biomassY3"</span>, <span class="va">species</span>, <span class="va">germany</span><span class="op">)</span>
<span class="va">spList</span></code></pre></div>
<pre><code><span class="co"># $pos.sp</span>
<span class="co"># [1] "DACGLO1" "FESPRA1" "LATPRA1" "LOTCOR1" "TRIPRA1" "TRIREP1"</span>
<span class="co"># </span>
<span class="co"># $neg.sp</span>
<span class="co"># [1] "CAMPAT1" "PHLPRA1" "RANACR1"</span>
<span class="co"># </span>
<span class="co"># $neu.sp</span>
<span class="co">#  [1] "ACHMIL1" "ALOPRA1" "ANTODO1" "ARRELA1" "BROHOR1" "CENJAC1" "CHRLEU1"</span>
<span class="co">#  [8] "CREBIE1" "CYNCRI1" "FESRUB1" "GERPRA1" "HOLLAN1" "KNAARV1" "LEOAUT1"</span>
<span class="co"># [15] "LOLPER1" "LYCFLO1" "PIMMAJ1" "PLALAN1" "RUMACE1" "TAROFF1" "VICCRA1"</span>
<span class="co"># [22] "VICSEP1"</span>
<span class="co"># </span>
<span class="co"># $functions</span>
<span class="co"># [1] "biomassY3"</span>
<span class="co"># </span>
<span class="co"># $coefs</span>
<span class="co">#     ACHMIL1     ALOPRA1     ANTODO1     ARRELA1     BROHOR1     CAMPAT1 </span>
<span class="co">#      0.0000      0.0000      0.0000      0.0000      0.0000   -391.5405 </span>
<span class="co">#     CENJAC1     CHRLEU1     CREBIE1     CYNCRI1     DACGLO1     FESPRA1 </span>
<span class="co">#      0.0000      0.0000      0.0000      0.0000    104.6404    135.6735 </span>
<span class="co">#     FESRUB1     GERPRA1     HOLLAN1     KNAARV1     LATPRA1     LEOAUT1 </span>
<span class="co">#      0.0000      0.0000      0.0000      0.0000    248.5566      0.0000 </span>
<span class="co">#     LOLPER1     LOTCOR1     LYCFLO1     PHLPRA1     PIMMAJ1     PLALAN1 </span>
<span class="co">#      0.0000    375.6694      0.0000   -297.7452      0.0000      0.0000 </span>
<span class="co">#     RANACR1     RUMACE1     TAROFF1     TRIPRA1     TRIREP1     VICCRA1 </span>
<span class="co">#   -140.2996      0.0000      0.0000    492.6311    325.0173      0.0000 </span>
<span class="co">#     VICSEP1 (Intercept) </span>
<span class="co">#      0.0000    335.8382 </span>
<span class="co"># </span>
<span class="co"># $effects</span>
<span class="co"># ACHMIL1 ALOPRA1 ANTODO1 ARRELA1 BROHOR1 CAMPAT1 CENJAC1 CHRLEU1 CREBIE1 CYNCRI1 </span>
<span class="co">#       0       0       0       0       0      -1       0       0       0       0 </span>
<span class="co"># DACGLO1 FESPRA1 FESRUB1 GERPRA1 HOLLAN1 KNAARV1 LATPRA1 LEOAUT1 LOLPER1 LOTCOR1 </span>
<span class="co">#       1       1       0       0       0       0       1       0       0       1 </span>
<span class="co"># LYCFLO1 PHLPRA1 PIMMAJ1 PLALAN1 RANACR1 RUMACE1 TAROFF1 TRIPRA1 TRIREP1 VICCRA1 </span>
<span class="co">#       0      -1       0       0      -1       0       0       1       1       0 </span>
<span class="co"># VICSEP1 </span>
<span class="co">#       0</span></code></pre>
<p>Using this as our starting point, we can use the getRedundancy
function to generate a) an effect matrix for all functions, b) a
coefficient matrix for all functions, and c) a standardized coefficient
matrix for all functions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">redund</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/getRedundancy.html">getRedundancy</a></span><span class="op">(</span><span class="va">german_vars</span>, <span class="va">species</span>, <span class="va">germany</span><span class="op">)</span>
<span class="va">coefs</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/getRedundancy.html">getRedundancy</a></span><span class="op">(</span><span class="va">german_vars</span>, <span class="va">species</span>, <span class="va">germany</span>, output<span class="op">=</span><span class="st">"coef"</span><span class="op">)</span>
<span class="va">stdCoefs</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/stdEffects.html">stdEffects</a></span><span class="op">(</span><span class="va">coefs</span>, <span class="va">germany</span>, <span class="va">german_vars</span>, <span class="va">species</span><span class="op">)</span>

<span class="co">#for example</span>
<span class="va">redund</span></code></pre></div>
<pre><code><span class="co">#           ACHMIL1 ALOPRA1 ANTODO1 ARRELA1 BROHOR1 CAMPAT1 CENJAC1 CHRLEU1</span>
<span class="co"># biomassY3       0       0       0       0       0      -1       0       0</span>
<span class="co"># root3           1       0      -1       0       1       0       0       0</span>
<span class="co"># N.g.m2          1       0       0      -1       0       0       0       0</span>
<span class="co"># N.Soil         -1       0      -1       0       1      -1       0       0</span>
<span class="co"># cotton3         0       1       1       0      -1       1       0       0</span>
<span class="co">#           CREBIE1 CYNCRI1 DACGLO1 FESPRA1 FESRUB1 GERPRA1 HOLLAN1 KNAARV1</span>
<span class="co"># biomassY3       0       0       1       1       0       0       0       0</span>
<span class="co"># root3           0       0       0       0       1       0      -1       0</span>
<span class="co"># N.g.m2         -1       0       0       1       0       0      -1       0</span>
<span class="co"># N.Soil          1       0       1      -1       0       0       0       0</span>
<span class="co"># cotton3         0       0       0       0       0       0       0       0</span>
<span class="co">#           LATPRA1 LEOAUT1 LOLPER1 LOTCOR1 LYCFLO1 PHLPRA1 PIMMAJ1 PLALAN1</span>
<span class="co"># biomassY3       1       0       0       1       0      -1       0       0</span>
<span class="co"># root3           1       0       1       0       0       0       0      -1</span>
<span class="co"># N.g.m2          0       0       1       1       0      -1       0      -1</span>
<span class="co"># N.Soil          1       0       0       1       0       1       0       0</span>
<span class="co"># cotton3        -1       0      -1       0       0       0       0       1</span>
<span class="co">#           RANACR1 RUMACE1 TAROFF1 TRIPRA1 TRIREP1 VICCRA1 VICSEP1</span>
<span class="co"># biomassY3      -1       0       0       1       1       0       0</span>
<span class="co"># root3          -1       0       0      -1       0       0       0</span>
<span class="co"># N.g.m2         -1       0       0       1       1       0       0</span>
<span class="co"># N.Soil          1       0       0      -1      -1       0       0</span>
<span class="co"># cotton3         0       0       0       1       1       0       0</span></code></pre>
<p>Using the effect matrix, we then estimate the average number of
species affecting all possible combinations of functions - both positive
and negative - and then plot the results.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#plot the num. functions by fraction of the species pool needed</span>
<span class="va">posCurve</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/divNeeded.html">divNeeded</a></span><span class="op">(</span><span class="va">redund</span>, type<span class="op">=</span><span class="st">"positive"</span><span class="op">)</span>

<span class="va">posCurve</span><span class="op">$</span><span class="va">div</span><span class="op">&lt;-</span><span class="va">posCurve</span><span class="op">$</span><span class="va">div</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">redund</span><span class="op">)</span>

<span class="va">pc</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">nfunc</span>, <span class="va">div</span>, data<span class="op">=</span><span class="va">posCurve</span>, group<span class="op">=</span><span class="va">nfunc</span>, geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"boxplot"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>height<span class="op">=</span><span class="fl">0.001</span>, width <span class="op">=</span> <span class="fl">.04</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Fraction of Species Pool\nwith Positive Effect\n"</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"\nNumber of Functions"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">24</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>


<span class="va">negCurve</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/divNeeded.html">divNeeded</a></span><span class="op">(</span><span class="va">redund</span>, type<span class="op">=</span><span class="st">"negative"</span><span class="op">)</span>

<span class="va">negCurve</span><span class="op">$</span><span class="va">div</span><span class="op">&lt;-</span><span class="va">negCurve</span><span class="op">$</span><span class="va">div</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">redund</span><span class="op">)</span>

<span class="va">nc</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">nfunc</span>, <span class="va">div</span>, data<span class="op">=</span><span class="va">negCurve</span>, group<span class="op">=</span><span class="va">nfunc</span>, geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"boxplot"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>height<span class="op">=</span><span class="fl">0.001</span>, width <span class="op">=</span> <span class="fl">.04</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Fraction of Species Pool\nwith Negative Effect\n"</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"\nNumber of Functions"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">24</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co">#combine these into one plot</span>
<span class="va">pc</span> <span class="op">+</span> <span class="va">nc</span> <span class="op">+</span>
   <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-12-1.png" width="1152"></p>
<p>We could have also looked at overlap indices, such as the Sorenson
index.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allOverlapPos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">redund</span><span class="op">)</span>,
                        <span class="op">~</span><span class="fu"><a href="../reference/getOverlapSummary.html">getOverlapSummary</a></span><span class="op">(</span><span class="va">redund</span>, m <span class="op">=</span> <span class="va">.x</span>, denom <span class="op">=</span> <span class="st">"set"</span><span class="op">)</span>,
                        .id <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span>

<span class="va">allOverlapPos</span></code></pre></div>
<pre><code><span class="co"># <span style="color: #949494;"># A tibble: 4 Ã— 4</span></span>
<span class="co">#   m     meanOverlap sdOverlap     n</span>
<span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co"># <span style="color: #BCBCBC;">1</span> 1          0.283      0.206    10</span>
<span class="co"># <span style="color: #BCBCBC;">2</span> 2          0.065<span style="text-decoration: underline;">8</span>     0.116    10</span>
<span class="co"># <span style="color: #BCBCBC;">3</span> 3          0          0         5</span>
<span class="co"># <span style="color: #BCBCBC;">4</span> 4          0         <span style="color: #BB0000;">NA</span>         1</span></code></pre>
<p>One weâ€™ve examined the consequences of functional overlap, we can
then move on to compare the number and size of these effects. First,
what is the relative balance of positive to negative contributions for
each species?</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">posNeg</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">redund</span><span class="op">)</span>,
                   Pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="../reference/filterOverData.html">filterOverData</a></span><span class="op">(</span><span class="va">redund</span><span class="op">)</span><span class="op">)</span>,
                   Neg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="../reference/filterOverData.html">filterOverData</a></span><span class="op">(</span><span class="va">redund</span>, type<span class="op">=</span><span class="st">"negative"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">#plot it</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Pos</span>,y<span class="op">=</span> <span class="va">Neg</span><span class="op">)</span>, data<span class="op">=</span><span class="va">posNeg</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.05</span>, height <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span>, shape<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">18</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"\n# of Positive Contributions per species\n"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"# of Negative Contributions per species\n"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">"a)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"glm"</span>, colour<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">2</span>, 
              method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>So, a generally positive relationship. We can see from the figure
that the slope is less than 1:1, so positive effects accumulate faster.
Still, more positive effects = more negative effects. What about the
size of those positive versus negative effects?</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#now get the standardized effect sizes</span>
<span class="va">posNeg</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">posNeg</span>, <span class="op">{</span>
  
  <span class="va">stdPosMean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="../reference/filterCoefData.html">filterCoefData</a></span><span class="op">(</span><span class="va">stdCoefs</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">Pos</span>
  <span class="va">stdPosMean</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">stdPosMean</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span><span class="fl">0</span>
  
  <span class="va">stdNegMean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="../reference/filterCoefData.html">filterCoefData</a></span><span class="op">(</span><span class="va">stdCoefs</span>, type<span class="op">=</span><span class="st">"negative"</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">Neg</span>
  <span class="va">stdNegMean</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">stdNegMean</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span><span class="fl">0</span>  
<span class="op">}</span><span class="op">)</span>


<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">stdPosMean</span>,y<span class="op">=</span> <span class="va">stdNegMean</span><span class="op">)</span>, data<span class="op">=</span><span class="va">posNeg</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">#  geom_point(size=3) +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.02</span>, height <span class="op">=</span> <span class="fl">.02</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span>, shape<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">18</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"\nAverage Standardized Size of\nPositive Contributions"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Average Standardized Size of\nNegative Contributions\n"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, colour<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0.25</span>, label<span class="op">=</span><span class="st">"b)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope<span class="op">=</span><span class="op">-</span><span class="fl">1</span>, intercept<span class="op">=</span><span class="fl">0</span>, size<span class="op">=</span><span class="fl">1</span>, colour<span class="op">=</span><span class="st">"black"</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="averaging-approach">Averaging Approach<a class="anchor" aria-label="anchor" href="#averaging-approach"></a>
</h2>
<p>Now weâ€™ll try the averaging approach. The first step is to create a
set of columns where we have standardized all of the functions of
interest, and then create an average of those standardized
functions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#add on the new functions along with the averaged multifunctional index</span>
<span class="va">germany</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">germany</span>, <span class="fu"><a href="../reference/getStdAndMeanFunctions.html">getStdAndMeanFunctions</a></span><span class="op">(</span><span class="va">germany</span>, <span class="va">german_vars</span><span class="op">)</span><span class="op">)</span>
<span class="co">#germany&lt;-cbind(germany, getStdAndMeanFunctions(germany, vars, standardizeZScore))</span></code></pre></div>
<p>We can then plot the averaged multifunctionality quite simply</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#plot it</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Diversity</span>, y<span class="op">=</span><span class="va">meanFunction</span><span class="op">)</span>,data<span class="op">=</span><span class="va">germany</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, colour<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"\nSpecies Richness"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Average Value of Standardized Functions\n"</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>We may want to look at all of the functions on a standardized scale,
and add in the averaged line for comparison as well. We can do this by
reshaping the data, and plotting it.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#reshape for plotting everything with ggplot2</span>
<span class="va">germanyMeanForPlotting</span> <span class="op">&lt;-</span> <span class="va">germany</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Diversity</span>, <span class="va">biomassY3.std</span><span class="op">:</span><span class="va">meanFunction</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">biomassY3.std</span><span class="op">:</span><span class="va">meanFunction</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html" class="external-link">fct_inorder</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span>
<span class="co">#nice names for plotting</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">germanyMeanForPlotting</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Aboveground Biomass'</span>, <span class="st">'Root Biomass'</span>, <span class="st">'Cotton Decomposition'</span>, <span class="st">'Soil Nitrogen'</span>, <span class="st">'Plant Nitrogen'</span>, <span class="st">'Mean Multifuncion Index'</span><span class="op">)</span>

<span class="co">#plot it</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Diversity</span>, y<span class="op">=</span><span class="va">value</span><span class="op">)</span>,data<span class="op">=</span><span class="va">germanyMeanForPlotting</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, colour<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"\nSpecies Richness"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Standardized Value of Function\n"</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-18-1.png" width="1536"></p>
<p>Last, letâ€™s test the statistical fit of the effect of diversity on
the averaged multifunctionality index.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#statistical fit</span>
<span class="va">aveFit</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">meanFunction</span> <span class="op">~</span> <span class="va">Diversity</span>, data<span class="op">=</span><span class="va">germany</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html" class="external-link">Anova</a></span><span class="op">(</span><span class="va">aveFit</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># Anova Table (Type II tests)</span>
<span class="co"># </span>
<span class="co"># Response: meanFunction</span>
<span class="co">#            Sum Sq Df F value    Pr(&gt;F)    </span>
<span class="co"># Diversity 0.29502  1   32.63 4.042e-07 ***</span>
<span class="co"># Residuals 0.52440 58                      </span>
<span class="co"># ---</span>
<span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aveFit</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># </span>
<span class="co"># Call:</span>
<span class="co"># lm(formula = meanFunction ~ Diversity, data = germany)</span>
<span class="co"># </span>
<span class="co"># Residuals:</span>
<span class="co">#       Min        1Q    Median        3Q       Max </span>
<span class="co"># -0.200533 -0.069321  0.006506  0.062717  0.288942 </span>
<span class="co"># </span>
<span class="co"># Coefficients:</span>
<span class="co">#             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co"># (Intercept) 0.385422   0.017049  22.606  &lt; 2e-16 ***</span>
<span class="co"># Diversity   0.015360   0.002689   5.712 4.04e-07 ***</span>
<span class="co"># ---</span>
<span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co"># </span>
<span class="co"># Residual standard error: 0.09509 on 58 degrees of freedom</span>
<span class="co"># Multiple R-squared:   0.36,   Adjusted R-squared:  0.349 </span>
<span class="co"># F-statistic: 32.63 on 1 and 58 DF,  p-value: 4.042e-07</span></code></pre>
</div>
<div class="section level2">
<h2 id="threshold-approach">Threshold Approach<a class="anchor" aria-label="anchor" href="#threshold-approach"></a>
</h2>
<p>First, we need to create a new data set that looks at the number of
functions greater than or equal to a threshold across a wide range of
thresholds.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanyThresh</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/getFuncsMaxed.html">getFuncsMaxed</a></span><span class="op">(</span><span class="va">germany</span>, <span class="va">german_vars</span>, threshmin<span class="op">=</span><span class="fl">0.05</span>, threshmax<span class="op">=</span><span class="fl">0.99</span>, prepend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plot"</span>,<span class="st">"Diversity"</span><span class="op">)</span>, maxN<span class="op">=</span><span class="fl">7</span><span class="op">)</span></code></pre></div>
<p>Next, letâ€™s perform an analysis on just the 0.8 threshold data.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mfuncGermanyLinear08</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">funcMaxed</span> <span class="op">~</span> <span class="va">Diversity</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">germanyThresh</span>, <span class="va">germanyThresh</span><span class="op">$</span><span class="va">thresholds</span><span class="op">==</span><span class="st">"0.8"</span><span class="op">)</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html" class="external-link">Anova</a></span><span class="op">(</span><span class="va">mfuncGermanyLinear08</span>, test.statistic<span class="op">=</span><span class="st">"F"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># Analysis of Deviance Table (Type II tests)</span>
<span class="co"># </span>
<span class="co"># Response: funcMaxed</span>
<span class="co"># Error estimate based on Pearson residuals </span>
<span class="co"># </span>
<span class="co">#           Sum Sq Df F value Pr(&gt;F)  </span>
<span class="co"># Diversity  6.375  1  6.4928 0.0135 *</span>
<span class="co"># Residuals 56.944 58                 </span>
<span class="co"># ---</span>
<span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mfuncGermanyLinear08</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># </span>
<span class="co"># Call:</span>
<span class="co"># glm(formula = funcMaxed ~ Diversity, family = quasipoisson(link = "identity"), </span>
<span class="co">#     data = subset(germanyThresh, germanyThresh$thresholds == </span>
<span class="co">#         "0.8"))</span>
<span class="co"># </span>
<span class="co"># Deviance Residuals: </span>
<span class="co">#     Min       1Q   Median       3Q      Max  </span>
<span class="co"># -1.4741  -0.9796  -0.8101   0.8364   2.0621  </span>
<span class="co"># </span>
<span class="co"># Coefficients:</span>
<span class="co">#             Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="co"># (Intercept)  0.27756    0.11302   2.456   0.0171 *</span>
<span class="co"># Diversity    0.05056    0.02476   2.042   0.0457 *</span>
<span class="co"># ---</span>
<span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co"># </span>
<span class="co"># (Dispersion parameter for quasipoisson family taken to be 0.9817929)</span>
<span class="co"># </span>
<span class="co">#     Null deviance: 66.909  on 59  degrees of freedom</span>
<span class="co"># Residual deviance: 60.534  on 58  degrees of freedom</span>
<span class="co"># AIC: NA</span>
<span class="co"># </span>
<span class="co"># Number of Fisher Scoring iterations: 6</span></code></pre>
<p>To get a better sense of how robust these results are to threshold
choice, letâ€™s plot the diversity versus number of functions greater than
or equal to a threshold for four different thresholds.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gcPlot</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">germanyThresh</span>, <span class="va">germanyThresh</span><span class="op">$</span><span class="va">thresholds</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/qw.html">qw</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="co">#note, using qw as %in% is a string comparison operator</span>

<span class="va">gcPlot</span><span class="op">$</span><span class="va">percent</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">gcPlot</span><span class="op">$</span><span class="va">thresholds</span>, <span class="st">"%"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">Diversity</span>, <span class="va">funcMaxed</span>, data<span class="op">=</span><span class="va">gcPlot</span>, facets<span class="op">=</span><span class="op">~</span><span class="va">percent</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"glm"</span>, 
              method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span><span class="op">)</span>,
              colour<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Number of Functions"</span> <span class="op">&gt;=</span> <span class="va">Threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Species Richness"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">gcPlot</span><span class="op">$</span><span class="va">percent</span><span class="op">)</span>,
                       lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="st">")"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
                       Diversity<span class="op">=</span><span class="fl">2</span>,
                       funcMaxed<span class="op">=</span><span class="fl">6</span>
                       <span class="op">)</span>, mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Diversity</span>, y<span class="op">=</span><span class="va">funcMaxed</span>, label<span class="op">=</span><span class="va">lab</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Given that variation, letâ€™s look at the entire spread of
thresholds.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanyThresh</span><span class="op">$</span><span class="va">percent</span> <span class="op">&lt;-</span> <span class="fl">100</span><span class="op">*</span><span class="va">germanyThresh</span><span class="op">$</span><span class="va">thresholds</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">germanyThresh</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Diversity</span>, y<span class="op">=</span><span class="va">funcMaxed</span>, group<span class="op">=</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Number of Functions"</span> <span class="op">&gt;=</span> <span class="va">Threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Species Richness"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"glm"</span>, 
                method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span><span class="op">)</span>, 
                lwd<span class="op">=</span><span class="fl">0.8</span>, fill<span class="op">=</span><span class="cn">NA</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Percent of \nMaximum"</span>, low<span class="op">=</span><span class="st">"blue"</span>, high<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="multiple-threshold-approach">Multiple Threshold Approach<a class="anchor" aria-label="anchor" href="#multiple-threshold-approach"></a>
</h2>
<p>To systematically explore the variation in the relationship based on
threshold choice, letâ€™s look at the slope of the relationship and its
confidence interval over all thresholds. We will then plot this
relationship.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanyLinearSlopes</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/getCoefTab.html">getCoefTab</a></span><span class="op">(</span><span class="va">funcMaxed</span> <span class="op">~</span> <span class="va">Diversity</span>,
                                data <span class="op">=</span> <span class="va">germanyThresh</span>, 
                                coefVar <span class="op">=</span> <span class="st">"Diversity"</span>,
                                family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span><span class="op">)</span>


<span class="co">######</span>
<span class="co"># Plot the values of the diversity slope at</span>
<span class="co"># different levels of the threshold</span>
<span class="co">######</span>
<span class="va">germanSlopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">germanyLinearSlopes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">thresholds</span><span class="op">*</span><span class="fl">100</span>,
                                                y <span class="op">=</span> <span class="va">estimate</span>,
                                                ymax <span class="op">=</span> <span class="va">estimate</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">std.error</span>,
                                                ymin <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">std.error</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Change in Number of Functions per Addition of 1 Species\n"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"\nThreshold (%)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fl">0</span>, slope<span class="op">=</span><span class="fl">0</span>, lwd<span class="op">=</span><span class="fl">1</span>, linetype<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>

<span class="va">germanSlopes</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-24-1.png" width="1152"></p>
<p>We can easily see a number of indices mentioned in the text - Tmin,
Tmax, Tmde, etc. Letâ€™s pull them out with our indices function.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanIDX</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getIndices.html">getIndices</a></span><span class="op">(</span><span class="va">germanyLinearSlopes</span>, <span class="va">germanyThresh</span>, <span class="va">funcMaxed</span> <span class="op">~</span> <span class="va">Diversity</span><span class="op">)</span>
<span class="va">germanIDX</span></code></pre></div>
<pre><code><span class="co">#   Tmin Tmax Tmde Rmde.linear Pmde.linear     Mmin    Mmax    Mmde nFunc</span>
<span class="co"># 1 0.11 0.81 0.41   0.1734241    0.554957 5.050544 1.06222 4.53135     5</span></code></pre>
<p>We can now add annotations to our earlier plot to make it more rich,
and show us those crucial threshold values.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanyLinearSlopes</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">germanyLinearSlopes</span><span class="op">$</span><span class="va">thresholds</span><span class="op">==</span><span class="va">germanIDX</span><span class="op">$</span><span class="va">Tmde</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co"># [1] 0.1734241</span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanyThresh</span><span class="op">$</span><span class="va">IDX</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">germanyThresh</span><span class="op">$</span><span class="va">IDX</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">germanyThresh</span><span class="op">$</span><span class="va">thresholds</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">germanIDX</span><span class="op">$</span><span class="va">Tmin</span>, <span class="va">germanIDX</span><span class="op">$</span><span class="va">Tmax</span>, <span class="va">germanIDX</span><span class="op">$</span><span class="va">Tmde</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>



<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">germanyThresh</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Diversity</span>, y<span class="op">=</span><span class="va">funcMaxed</span>, group<span class="op">=</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Number of Functions"</span> <span class="op">&gt;=</span> <span class="va">Threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Species Richness"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"glm"</span>, 
              method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span><span class="op">)</span>, 
              fill<span class="op">=</span><span class="cn">NA</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">percent</span>, lwd<span class="op">=</span><span class="va">IDX</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Percent of \nMaximum"</span>, low<span class="op">=</span><span class="st">"blue"</span>, high<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">5</span><span class="op">)</span>, guide<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">"text"</span>, x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">2</span>,<span class="fl">4.6</span><span class="op">)</span>, label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tmax"</span>, <span class="st">"Tmde"</span>, <span class="st">"Tmin"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">"text"</span>, x<span class="op">=</span><span class="fl">16.7</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">germanIDX</span><span class="op">$</span><span class="va">Mmin</span>, <span class="va">germanIDX</span><span class="op">$</span><span class="va">Mmax</span>, <span class="va">germanIDX</span><span class="op">$</span><span class="va">Mmde</span><span class="op">)</span>, label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mmin"</span>, <span class="st">"Mmax"</span>, <span class="st">"Mmde"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-26-1.png" width="1152"></p>
<p>Or we can see where they are on the curve of slopes at different
thresholds.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">germanSlopes</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">"text"</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>, <span class="op">-</span><span class="fl">0.01</span>, <span class="op">-</span><span class="fl">0.01</span>, <span class="va">germanIDX</span><span class="op">$</span><span class="va">Rmde.linear</span><span class="op">+</span><span class="fl">0.02</span><span class="op">)</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">germanIDX</span><span class="op">$</span><span class="va">Tmin</span><span class="op">*</span><span class="fl">100</span>, <span class="va">germanIDX</span><span class="op">$</span><span class="va">Tmde</span><span class="op">*</span><span class="fl">100</span>, <span class="va">germanIDX</span><span class="op">$</span><span class="va">Tmax</span><span class="op">*</span><span class="fl">100</span>, <span class="va">germanIDX</span><span class="op">$</span><span class="va">Tmde</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>,  label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="st">"Tmde"</span>, <span class="st">"Tmax"</span>, <span class="st">"Rmde"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span> </code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-27-1.png" width="1152"></p>
</div>
<div class="section level2">
<h2 id="comparison-of-sites">Comparison of Sites<a class="anchor" aria-label="anchor" href="#comparison-of-sites"></a>
</h2>
<p>Furthermore, we can extend this to the more of the BIODEPTH dataset
to compare the strength of multifunctionality across sites. We begin by
loading in the data and calculating slopes at different thresholds.
Weâ€™ll subset down to Sheffield, Portugal, and Sweden for simplicity, but
this could be done for all sites quite easily.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">####</span>
<span class="co"># Now we will look at the entire BIODEPTH dataset</span>
<span class="co">#</span>
<span class="co"># Note the use of dplyr to generate the new data frame using all locations from biodepth.</span>
<span class="co"># If you're not using dplyr for your data aggregation, you should be!</span>
<span class="co"># It will save you a lot of time and headaches in the future.</span>
<span class="co">####</span>

<span class="co">#Read in data  to run sample analyses on the biodepth data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">all_biodepth</span><span class="op">)</span>
<span class="va">sub_biodepth</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_biodepth</span>, <span class="va">all_biodepth</span><span class="op">$</span><span class="va">location</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sheffield"</span>, <span class="st">"Portugal"</span>, <span class="st">"Sweden"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sub_biodepth</span><span class="op">$</span><span class="va">location</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sub_biodepth</span><span class="op">$</span><span class="va">location</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Portugal"</span>, <span class="st">"Sweden"</span>, <span class="st">"Sheffield"</span><span class="op">)</span><span class="op">)</span>

<span class="va">allVars</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/qw.html">qw</a></span><span class="op">(</span><span class="va">biomassY3</span>, <span class="va">root3</span>, <span class="va">N.g.m2</span>,  <span class="va">light3</span>, <span class="va">N.Soil</span>, <span class="va">wood3</span>, <span class="va">cotton3</span><span class="op">)</span>
<span class="va">varIdx</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sub_biodepth</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">allVars</span><span class="op">)</span>



<span class="co">#re-normalize so that everything is on the same </span>
<span class="co">#sign-scale (e.g. the maximum level of a function is </span>
<span class="co">#the "best" function)</span>
<span class="va">sub_biodepth</span> <span class="op">&lt;-</span> <span class="va">sub_biodepth</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    <span class="va">light3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">light3</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>,
      <span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">light3</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">light3</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
      <span class="cn">NA</span><span class="op">)</span>,
    
    <span class="va">N.Soil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">N.Soil</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>,
      <span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">N.Soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">N.Soil</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
      <span class="cn">NA</span><span class="op">)</span>
  <span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span>


<span class="co">#get thresholds</span>
<span class="va">bdThreshes</span><span class="op">&lt;-</span><span class="va">sub_biodepth</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fmaxed <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">getFuncsMaxed</span>,
                         vars<span class="op">=</span><span class="va">allVars</span>,
                         maxN<span class="op">=</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">fmaxed</span><span class="op">)</span>



<span class="co">####look at slopes</span>

<span class="co">#note, maxIT argument is due to some fits needing more iterations to converge</span>
<span class="va">bdLinearSlopes</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/getCoefTab.html">getCoefTab</a></span><span class="op">(</span><span class="va">funcMaxed</span> <span class="op">~</span> <span class="va">Diversity</span>,
                           data<span class="op">=</span><span class="va">bdThreshes</span>,
                           groupVar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"thresholds"</span><span class="op">)</span>, 
                           coefVar<span class="op">=</span><span class="st">"Diversity"</span>,
                           family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span>,
                           control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">800</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span>
<span class="co"># Error : no valid set of coefficients has been found: please supply starting values</span></code></pre>
<p>Great, now we can look at the indices of these three new sites. Weâ€™ll
add Germany in so we can compare them against the German values.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indexTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">bdLinearSlopes</span><span class="op">$</span><span class="va">location</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">slopedata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">bdLinearSlopes</span>, <span class="va">bdLinearSlopes</span><span class="op">$</span><span class="va">location</span><span class="op">==</span><span class="va">x</span><span class="op">)</span> 
  <span class="va">threshdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">bdThreshes</span>, <span class="va">bdThreshes</span><span class="op">$</span><span class="va">location</span><span class="op">==</span><span class="va">x</span><span class="op">)</span> 
  <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getIndices.html">getIndices</a></span><span class="op">(</span><span class="va">slopedata</span>, <span class="va">threshdata</span>, <span class="va">funcMaxed</span> <span class="op">~</span> <span class="va">Diversity</span><span class="op">)</span>
  <span class="va">ret</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>location<span class="op">=</span><span class="va">x</span>, <span class="va">ret</span><span class="op">)</span>
  <span class="va">ret</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">indexTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">indexTable</span><span class="op">)</span>

<span class="va">indexTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>location<span class="op">=</span><span class="st">"Germany"</span>, <span class="va">germanIDX</span><span class="op">)</span>, <span class="va">indexTable</span><span class="op">)</span>


<span class="va">indexTable</span></code></pre></div>
<pre><code><span class="co">#     location Tmin Tmax Tmde Rmde.linear Pmde.linear     Mmin     Mmax     Mmde</span>
<span class="co"># 1    Germany 0.11 0.81 0.41   0.1734241   0.5549570 5.050544 1.062220 4.531350</span>
<span class="co"># 13  Portugal   NA 0.29 0.19   0.1715245   0.4002239       NA 4.466414 5.705561</span>
<span class="co"># 11    Sweden 0.05 0.47 0.11   0.1486650   0.2973299 5.943906 1.998405 5.725218</span>
<span class="co"># 12 Sheffield 0.06   NA 0.55   0.1198584   0.3595751 3.709067       NA 3.212588</span>
<span class="co">#    nFunc</span>
<span class="co"># 1      5</span>
<span class="co"># 13     6</span>
<span class="co"># 11     6</span>
<span class="co"># 12     4</span></code></pre>
<p>Finally, letâ€™s compare a visualization of the relevant curves at
different thresholds to the relationship between threshold and slope of
curve to give the table of numbers some visual meaning.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>

<span class="va">bdCurvesAll</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">Diversity</span>, <span class="va">funcMaxed</span>, data<span class="op">=</span><span class="va">bdThreshes</span>, group<span class="op">=</span><span class="va">thresholds</span>, alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">location</span><span class="op">)</span><span class="op">+</span><span class="co">#, scales="free") +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"blue"</span>, high<span class="op">=</span><span class="st">"red"</span>, name<span class="op">=</span><span class="st">"Proportion of \nMaximum"</span>, guide<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"glm"</span>, lwd<span class="op">=</span><span class="fl">0.8</span>, fill<span class="op">=</span><span class="cn">NA</span>,
              method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span>, 
                                 control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">thresholds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"\nNumber of Functions â‰¥ Threshold\n\n"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Species Richness"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">15</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">bdThreshes</span><span class="op">$</span><span class="va">location</span><span class="op">)</span>, lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="st">")"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>, thresholds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>, x<span class="op">=</span><span class="fl">1</span>, y<span class="op">=</span><span class="fl">7</span>, mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">lab</span><span class="op">)</span><span class="op">)</span>



<span class="co">#Plot it!</span>
<span class="va">slopePlot</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bdLinearSlopes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">thresholds</span><span class="op">*</span><span class="fl">100</span>, 
                                      y<span class="op">=</span><span class="va">estimate</span>,
                                      ymin <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">std.error</span>,
                                      ymax <span class="op">=</span> <span class="va">estimate</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">std.error</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Change in Number of Functions \nper Addition of 1 Species\n"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Threshold (%)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">location</span><span class="op">)</span><span class="op">+</span><span class="co">#, scale="free") +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fl">0</span>, slope<span class="op">=</span><span class="fl">0</span>, lwd<span class="op">=</span><span class="fl">0.6</span>, linetype<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">bdThreshes</span><span class="op">$</span><span class="va">location</span><span class="op">)</span>, 
                            lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, <span class="st">")"</span>, 
                                        sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>, 
                            thresholds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,
                            std.error<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,
                            estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>
                            <span class="op">)</span>, 
            x<span class="op">=</span><span class="fl">0.05</span>, y<span class="op">=</span><span class="fl">0.27</span>, mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">lab</span><span class="op">)</span><span class="op">)</span>


<span class="co">###Plot them in a single figure</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">bdCurvesAll</span>,
             <span class="va">slopePlot</span><span class="op">)</span> </code></pre></div>
<p><img src="multifunc_biodepth_files/figure-html/unnamed-chunk-30-1.png" width="960"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jarrett Byrnes.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
